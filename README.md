# Figma卡片导出器桌面应用

这个桌面应用程序是Figma插件"Text Capitalizer"的配套工具，可以实现图片自动保存到指定目录，无需手动选择保存位置。

## 工作原理

1. 桌面应用运行一个本地服务器，监听来自Figma插件的请求
2. Figma插件生成卡片图片后，会尝试连接桌面应用
3. 如果连接成功，图片会自动保存到指定路径
4. 如果连接失败，则回退到普通的浏览器下载方式

## 安装步骤

### 1. 安装Node.js

确保您的电脑上已安装Node.js（建议版本14.0.0或更高）。

访问[Node.js官网](https://nodejs.org/)下载并安装最新LTS版本。

### 2. 安装依赖

1. 打开命令提示符或PowerShell
2. 导航到桌面应用目录
3. 运行以下命令安装依赖：

```
cd F:\LiFeng\Project\windsurf\FigmaPluginAPIProjectOne\desktop-app
npm install
```

### 3. 创建图标

运行以下命令生成应用图标：

```
node create-icon.js
```

## 启动应用

### 方法1：使用批处理文件（推荐）

双击运行以下批处理文件之一：

- `启动服务器.bat` - 启动服务器（使用增强版调试服务器）
- `启动调试服务器.bat` - 启动带有详细日志的调试服务器

### 方法2：直接从命令行启动

每次需要使用时，在命令提示符中运行：

```
cd F:\LiFeng\Project\windsurf\FigmaPluginAPIProjectOne\desktop-app
node debug-server.js
```

## 使用方法

1. 启动桌面应用
2. 桌面应用会在系统托盘中显示图标
3. 可以点击托盘图标打开应用界面查看日志
4. 打开Figma并使用修改后的插件
5. 插件会自动检测桌面应用是否运行
6. 如果桌面应用已连接，导出的图片会自动保存到指定位置

## 安装新版Figma插件

您需要使用更新的Figma插件与桌面应用配合使用：

1. 将`desktop-app/figma-plugin`目录中的文件复制到您的Figma插件目录
2. 或者在Figma中重新导入这个插件

## 导出目录

默认情况下，图片会保存到：
```
F:\LiFeng\Project\windsurf\ShortsMaster_RedditStory\data\exports\{channelName}\
```

如果该目录不存在，系统会自动创建。

## 系统托盘功能

应用运行后会在系统托盘显示一个图标，右键点击可以：

1. 显示应用窗口（查看日志）
2. 退出应用

## 注意事项

1. 使用前确保桌面应用正在运行
2. 如果更换了电脑或路径发生变化，需要修改代码中的路径配置
3. 应用在后台运行，可从系统托盘访问
4. 关闭窗口不会退出应用，需要从托盘菜单选择"退出"

## 故障排除

1. **插件报告"桌面应用未连接"**
   - 确保桌面应用正在运行
   - 检查防火墙是否阻止了端口54545
   - 重启桌面应用

2. **图片未保存到正确位置**
   - 检查应用窗口中的日志信息
   - 确认路径是否正确
   - 检查写入权限

3. **应用崩溃**
   - 检查Node.js版本是否最新
   - 重新安装依赖：`npm install`
   - 检查控制台错误信息

4. 如果遇到"桌面应用未连接"的问题，请尝试以下步骤：
   1. 确保服务器正在运行（控制台窗口打开并显示"服务器已启动"消息）
   2. 检查Windows防火墙是否阻止了Node.js访问网络
   3. 在Figma中重新加载插件（右键点击插件 > 重新加载）
   4. 如果问题仍然存在，尝试使用`启动调试服务器.bat`启动带有详细日志的服务器

## 更新日志

### 2025-02-26
- 改进了服务器连接稳定性
- 添加了详细的调试日志
- 优化了CORS设置，解决了连接问题
- 添加了状态检查端点
